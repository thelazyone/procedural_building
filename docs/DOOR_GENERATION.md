# Door Generation

## Overview

Doors are generated by the `FloorGenerator` class, which handles all floor-level elements (doors, windows, corners, etc.).

## How It Works

### Floor Generator

The `FloorGenerator` is responsible for:
- Generating door placements on floor perimeter edges
- (Future) Generating windows
- (Future) Generating other floor elements

### Door Placement Logic

For **ground floor only** (floor_idx == 0):

1. **Calculate number of doors**
   - Based on `door_density` parameter (doors per meter of perimeter)
   - Formula: `num_doors = max(1, int(total_perimeter * door_density))`
   
2. **For each door:**
   - **Pick edge**: Random edge weighted by edge length (longer edges more likely)
   - **Pick position**: Random position along edge, respecting `edge_spacing` from corners
   - **Calculate facing direction**: Outward normal perpendicular to the edge

3. **DoorPlacement object contains:**
   - `edge_idx`: Which edge the door is on
   - `position_on_edge`: Normalized position (0.0 = start, 1.0 = end)
   - `edge_start`, `edge_end`: Edge endpoints
   - `facing_direction`: (x, y) normalized vector pointing outward
   - `floor_idx`: Floor index

## Parameters

### Exposed Parameters (in UI)
- **door_density**: Doors per meter of perimeter (default: 0.05)
  - Example: 40m perimeter Ã— 0.05 = 2 doors

### Code Parameters (not exposed)
- **edge_spacing**: Minimum distance from edge corners (default: 1.0m)
  - Prevents doors from being placed too close to corners

## Usage

```python
from core.building import Building

# Create building
building = Building(
    floors=[
        [(-5, -5), (5, -5), (5, 5), (-5, 5)],  # Ground floor
    ],
    seed=12345,
    floor_heights=[3.0]
)

# Get ground floor and generate doors
ground_floor = building.get_floor(0)
doors = ground_floor.get_doors(
    seed=12345,
    door_density=0.05,
    edge_spacing=1.0
)

# Inspect door placements
for door in doors:
    print(f"Door on edge {door.edge_idx}")
    print(f"  Position: {door.position_on_edge:.2f}")
    print(f"  Facing: {door.facing_direction}")
```

## Visualization

The `debug_viewer` will soon visualize doors as markers on the building footprint.

## Future Enhancements

- [ ] Visualize doors in 3D viewer
- [ ] Add door size/style parameters
- [ ] Ensure doors don't overlap with windows
- [ ] Support doors on upper floors (balconies, fire exits)
- [ ] Add main entrance designation
- [ ] Add door types (single, double, sliding, etc.)
